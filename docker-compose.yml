services:
  redis:
    image: redis:latest
    container_name: redis-container
    ports:
      - "6379:6379"  # Map Redis port to localhost
    networks:
      - app-network

  mongodb:
    image: mongo:latest
    container_name: mongodb-container
    ports:
      - "27017:27017"  # Map MongoDB port to localhost
    networks:
      - app-network
    volumes:
      - mongodb-data:/data/db  # Persistent storage for MongoDB

  backend:
    build:
      context: ./backend  # Path to your NestJS backend directory
      dockerfile: Dockerfile
    container_name: backend-container
    ports:
      - "3000:3000"  # Map backend port to localhost
    depends_on:
      - redis        # Ensure Redis starts before the backend
      - mongodb      # Ensure MongoDB starts before the backend
    networks:
      - app-network
    environment:
      REDIS_HOST: redis
      REDIS_PORT: 6379
      MONGO_URI: mongodb://mongodb:27017/your_database_name

  frontend:
    build:
      context: ./frontend  # Path to your frontend directory
      dockerfile: Dockerfile
    container_name: frontend-container
    ports:
      - "9000:9000"  # Map frontend port to localhost
    depends_on:
      - backend      # Ensure the backend starts before the frontend
    networks:
      - app-network

networks:
  app-network:
    driver: bridge

volumes:
  mongodb-data:
